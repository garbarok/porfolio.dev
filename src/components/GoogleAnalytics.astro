---
/**
 * Google Analytics 4 Component
 *
 * Add your GA4 Measurement ID to the environment variable:
 * PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX
 *
 * This component uses Partytown for optimized third-party script loading
 */

const GA_MEASUREMENT_ID = import.meta.env.PUBLIC_GA_MEASUREMENT_ID

// Only load GA in production and when measurement ID is configured
const isProduction = import.meta.env.PROD
const shouldLoadGA = isProduction && GA_MEASUREMENT_ID
---

{
  shouldLoadGA && (
    <>
      <!-- Google tag (gtag.js) with Partytown -->
      <script
        is:inline
        type="text/partytown"
        src={`https://www.googletagmanager.com/gtag/js?id=${GA_MEASUREMENT_ID}`}
      />
      <script is:inline type="text/partytown" define:vars={{ GA_MEASUREMENT_ID }}>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
          dataLayer.push(arguments);
        }
        gtag("js", new Date());
        gtag("config", GA_MEASUREMENT_ID, {
          page_path: window.location.pathname,
        });
      </script>
    </>
  )
}

<!-- Development mode indicator (only visible in dev) -->
{
  !isProduction && (
    <script>
      console.log(
        "ðŸ“Š Google Analytics is disabled in development mode",
      );
    </script>
  )
}
