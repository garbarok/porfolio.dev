---
import { getCollection } from 'astro:content'
import Layout from '@layouts/Layout.astro'
import FeaturedPostSection from '@components/blog/featured-post-section.astro'
import BlogGrid from '@components/blog/blog-grid.astro'
import { getPublishedPosts, sortByDate } from '@/utils/blog'

const allPosts = await getCollection('blog')
const publishedPosts = sortByDate(getPublishedPosts(allPosts))

const [featuredPost, ...otherPosts] = publishedPosts
const recentPosts = otherPosts.slice(0, 3)
const remainingPosts = otherPosts.slice(3)
---

<Layout
  title="Blog - Óscar Gallego"
  description="Artículos sobre desarrollo web, JavaScript, TypeScript, Astro y las últimas tendencias en tecnología."
>
  <!-- Structured Data - Blog Collection -->
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'Blog',
      name: 'Blog de Óscar Gallego',
      description:
        'Artículos sobre desarrollo web, JavaScript, TypeScript, Astro y las últimas tendencias en tecnología.',
      url: 'https://oscargallegoruiz.com/blog',
      author: {
        '@type': 'Person',
        name: 'Óscar Gallego',
        url: 'https://oscargallegoruiz.com',
      },
      inLanguage: 'es-ES',
      blogPost: publishedPosts.slice(0, 10).map((post) => ({
        '@type': 'BlogPosting',
        headline: post.data.title,
        description: post.data.description,
        url: `https://oscargallegoruiz.com/blog/${post.id}`,
        datePublished: post.data.pubDate.toISOString(),
        dateModified: (post.data.updatedDate || post.data.pubDate).toISOString(),
        author: {
          '@type': 'Person',
          name: post.data.author,
        },
        image: post.data.image?.url || 'https://oscargallegoruiz.com/og-image.jpg',
      })),
    })}
    slot="head"
  />

  <!-- Breadcrumb Structured Data -->
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'BreadcrumbList',
      itemListElement: [
        {
          '@type': 'ListItem',
          position: 1,
          name: 'Inicio',
          item: 'https://oscargallegoruiz.com',
        },
        {
          '@type': 'ListItem',
          position: 2,
          name: 'Blog',
          item: 'https://oscargallegoruiz.com/blog',
        },
      ],
    })}
    slot="head"
  />

  <section class="px-6 py-24 sm:py-32 lg:px-8">
    <div class="mx-auto max-w-2xl text-center">
      <p class="text-base/7 font-semibold text-sky-500 dark:text-sky-400">Desarrollo Web</p>
      <h1 class="mt-2 text-5xl font-semibold tracking-tight text-gray-900 sm:text-7xl dark:text-white">
        Blog
      </h1>
      <p class="mt-8 text-pretty text-lg font-medium text-gray-600 sm:text-xl/8 dark:text-gray-400">
        Comparto mi experiencia y conocimientos sobre desarrollo web, mejores
        prácticas y las últimas tecnologías.
      </p>
    </div>
  </section>

  {
    featuredPost && recentPosts.length > 0 && (
      <FeaturedPostSection
        featuredPost={featuredPost}
        recentPosts={recentPosts}
      />
    )
  }

  {
    remainingPosts.length > 0 && (
      <BlogGrid
        posts={remainingPosts}
        title="Más artículos"
        description="Explora más contenido sobre desarrollo web y tecnología."
      />
    )
  }

  {
    publishedPosts.length === 0 && (
      <section class="mx-auto max-w-7xl px-4 pb-24 sm:px-6 lg:px-8">
        <div class="mx-auto max-w-2xl text-center">
          <p class="text-gray-600 dark:text-gray-400">
            No hay artículos publicados todavía. ¡Vuelve pronto!
          </p>
        </div>
      </section>
    )
  }

  <section class="mx-auto max-w-7xl py-24 sm:px-6 sm:py-32 lg:px-8">
    <div class="relative isolate overflow-hidden bg-gray-900 px-6 py-24 text-center shadow-2xl sm:rounded-3xl sm:px-16 dark:bg-gray-950">
      <h2 class="text-4xl font-semibold tracking-tight text-balance text-white sm:text-5xl">
        ¿Quieres estar al día?
      </h2>
      <p class="mx-auto mt-6 max-w-xl text-pretty text-lg/8 text-gray-300">
        Sígueme en mis redes sociales para no perderte ningún artículo y estar
        al tanto de las últimas novedades en desarrollo web.
      </p>
      <nav class="mt-10 flex items-center justify-center gap-x-6" aria-label="Social media links">
        <a
          href="https://github.com/garbarok"
          target="_blank"
          rel="noopener noreferrer"
          class="rounded-md bg-white px-3.5 py-2.5 text-sm font-semibold text-gray-900 shadow-sm transition-colors hover:bg-gray-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white"
        >
          Ver GitHub
        </a>
        <a
          href="https://www.linkedin.com/in/oscargallegoruiz/"
          target="_blank"
          rel="noopener noreferrer"
          class="text-sm/6 font-semibold text-white transition-colors hover:text-gray-300"
        >
          Conectar en LinkedIn <span aria-hidden="true">→</span>
        </a>
      </nav>
      <svg
        viewBox="0 0 1024 1024"
        aria-hidden="true"
        class="absolute left-1/2 top-1/2 -z-10 size-[64rem] -translate-x-1/2 [mask-image:radial-gradient(closest-side,white,transparent)]"
      >
        <circle r="512" cx="512" cy="512" fill="url(#blog-cta-gradient)" fill-opacity="0.7"></circle>
        <defs>
          <radialGradient id="blog-cta-gradient">
            <stop stop-color="#0ea5e9"></stop>
            <stop offset="1" stop-color="#3b82f6"></stop>
          </radialGradient>
        </defs>
      </svg>
    </div>
  </section>
</Layout>
